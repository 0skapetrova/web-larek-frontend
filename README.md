# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

Данные товара

```
interface IProduct {
    id: string;
    description: string;
    image: string;
    title: string;
    category: string;
    price: number;
}
```

Данные заказа

```
interface IOrder {
    payment: string
    email: string
    phone: string
    address: string
    total: number
    items: string[]
}
```

Интерфейс для модели данных товаров
```
interface IProductList {
    products: IProduct[];
    getProduct(productId: string): IProduct;
}
```

Интерфейс для модели данных корзины
```
interface ICart {
    products: IProduct[];
    addProduct(product: IProduct): void;
    deleteProduct(productId: string): void;
    emptyCart(): void;
    getCount(): number;
    getTotal(): number;
    isEmpty(): boolean;
    inCart(id: string): boolean;
}
```

Интерфейс для модели данных покупателя
```
interface IClientData {
    clientData: TClientOrderData & TClientPersonalData;
}
```

Данные покупателя, используемые в форме данных заказа

```
export type TClientOrderData = Pick<IClient, 'paymentMethod' | 'address'>;
```

Данные покупателя, используемые в форме данных покупателя

```
export type TClientPersonalData = Pick<IClient, 'email' | 'phoneNumber'>;
```

Тип для записи ошибок

```
type FormErrors = Partial<Record<keyof IOrder, string>>;
```


## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVC:
- слой данных, отвечающий за хранение и изменение данных
- слой представления, отвечающий за отображение данных на странице
- контроллер, отвечающий за взаимодействие данных и представления, обрабатывая события

### Базовый код

#### Класс BaseApi
Содержит в себе базовую логику отправки запросов./
- constructor(baseUrl: string, options: RequestInit = {}) В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы: 
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

### Слой данных


#### Класс ProductsData
Класс отвечает за хранение и работу с данными товаров.\
- constructor (events: IEvents) Конструктор класса принимает экземпляр класса EventEmitter для создания событий\

Поля класса:
- _products: IProduct[] - массив объектов товаров
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных

Методы:
- set products(products:IProduct[]): IProduct[] - сеттер списка товаров
- get products (): IProduct[] - геттер списка товаров
- getProduct(productId: string): IProduct - метод для получения одного товара по id


#### Класс CartData
Класс отвечает за хранение и работу с данными товаров для покупки.\
- constructor (events: IEvents) Конструктор класса принимает экземпляр класса EventEmitter для создания событий\

Поля класса:
- _products: IProduct[] - массив объектов товаров
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных

Методы:
- get products(): IProduct[] - геттер списка товаров в корзине
- get productsForOrder(): IProduct[] - геттер товаров для заказа за вычетом бесценного товара
- addProduct(product: IProduct): void - метод для добавления одного товара, вызывает событие изменения массива
- deleteProduct(productId: string): void - метод для удаления товара по id, вызывает событие изменения массива
- emptyBasket(): void - метод для очистки корзины
- getCount(): number - метод для подсчета количества товаров в корзине
- getTotal(): number - метод для подсчета общей стоимости товаров в корзине, исключая бесценный
- isEmpty(): boolean - метод для проверки наличия товаров в корзине для управления состоянием кнопки
- inCart(id: string): boolean - метод для проверки наличия конкретного товара в корзине для управления состоянием кнопки в карточке превью товара



#### Класс ClientData
Класс отвечает за хранение и работу с данными покупателя.\
- constructor (events: IEvents) Конструктор класса принимает экземпляр класса EventEmitter для создания событий\

Поля класса:
- _clientData: TClientOrderData & TClientPersonalData - данные покупателя для заказа, полученные из форм
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных

Методы:
- getClientData(): IClient - возвращает данные покупателя
- setOrderField(field: keyof TClientOrderData, value: string): void - метод для заполнения свойств объекта данными из формы заказа
- validateOrder(): boolean - метод для валидации данных из формы заказа
- setContactsField(field: keyof TClientPersonalData, value: string): void - метод для заполнения свойств объекта данными из формы контактов
- validateContacts(): boolean - метод для валидации данных из формы контактов


### Слой представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.


#### Базовый класс Component
Класс является дженериком и родителем всех компонентов слоя представления. В дженерик принимает тип объекта, в котором данные будут передаваться в метод render для отображения данных в компоненте. В конструктор принимает элемент разметки, являющийся основным родительским контейнером компонента. Содержит метод render, отвечающий за сохранение полученных в параметре данных в полях компонентов через их сеттеры, возвращает обновленный контейнер компонента.


#### Базовый класс Modal
Реализует модальное окно. Так же предоставляет методы `open` и `close` для управления отображением модального окна. Устанавливает слушатели на клавиатуру, для закрытия модального окна по Esc, на клик в оверлей и кнопку-крестик для закрытия попапа.  
- constructor(template: HTMLTemplateElement, events: IEvents) Конструктор принимает темплейт необходимого модального окна и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса
- modal: HTMLElement - элемент модального окна
- template: HTMLTemplateElement - темплейт
- events: IEvents - брокер событий


#### Базовый класс ProductBase
Реализует отображение товара. В методах сеттеры наименования и цены. А также сеттер и геттер Id товара.
- constructor (protected container: HTMLElement,	events: IEvents) Конструктор принимает элемент разметки контейнера и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса
- _title: HTMLElement - элемент для наименования
- _price: HTMLElement - элемент для вывода цены
- _button: HTMLButtonElement - кнопка
- events: IEvents - брокер событий

Методы
- abstract addEventListeners(): void - абстрактный класс для установки слушателей событий


#### Класс ProductInCatalog
Реализует отображение товара в каталоге. В методах сеттеры категории и изображения. 
- constructor(template: HTMLTemplateElement, events: IEvents) Конструктор принимает элемент разметки контейнера и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса
- _title: HTMLElement - элемент для наименования
- _category: HTMLElement - элемент для категории
- _image: HTMLImageElement - элемент для изображения
- _price: HTMLElement - элемент для вывода цены
- events: IEvents - брокер событий

Методы
- addEventListeners(): void - устанавливает слушатель на контейнер


#### Класс ProductPreview
Реализует отображение полной карточки товара. В методах сеттер описания и сеттер состояния наличия товара в корзине для управления состоянием и тектом кнопки покупки. 
- constructor(template: HTMLTemplateElement, events: IEvents) Конструктор принимает элемент разметки контейнера и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса
- _title: HTMLElement - элемент для наименования
- _category: HTMLElement - элемент для категории
- _description: HTMLElement - элемент для описания
- _image: HTMLImageElement - элемент для изображения
- _price: HTMLElement - элемент для вывода цены
- _button: HTMLButtonElement - кнопка покупки
- events: IEvents - брокер событий

Методы
- addEventListeners(): void - устанавливает слушатель на кнопку покупки


#### Класс ProductInCart
Реализует отображение карточки товара в корзине. 
- constructor(template: HTMLTemplateElement, events: IEvents) Конструктор принимает элемент разметки контейнера и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса
- _title: HTMLElement - элемент для наименования
- _category: HTMLElement - элемент для категории
- _description: HTMLElement - элемент для описания
- _image: HTMLImageElement - элемент для изображения
- _price: HTMLElement - элемент для вывода цены
- _button: HTMLButtonElement - кнопка покупки
- events: IEvents - брокер событий

Методы
- addEventListeners(): void - устанавливает слушатель на кнопку удаления из корзины


#### Класс Cart
Предназначен для отображения корзины.
Предоставляет методы для отображения списка товаров и общей стоимости, а также сеттер заполненности корзины для управления состоянием кнопки подтверждения.

Поля класса:
- _list: HTMLElement[] - элемент разметки для отображения списка товаров для покупки
- _total: HTMLElement - элемент разметки для отображения стоимости заказа
- _button: HTMLButtonElement - Кнопка подтверждения


#### Базовый класс Form
Предназначен для реализации формы, содержащей поля ввода. При сабмите инициирует событие передавая в него объект с данными из полей ввода формы. При изменении данных в полях ввода инициирует событие изменения данных. Предоставляет методы для отображения ошибок и управления активностью кнопки.\

Поля класса:
- _submit: HTMLButtonElement - Кнопка подтверждения
- _errors: HTMLElement - объект хранящий элемент для вывода ошибок под полями формы

Методы:
- set valid(value: boolean) - изменяет активность кнопки подтверждения
- set errors(value: string) - устанавливает текст ошибки
- onInputChange(field: keyof T, value: string) - инициирует событие передавая в него объект с данными из полей ввода формы


#### Класс Order
Предназначен для реализации формы заполнения данных заказа.\
- constructor(container: HTMLFormElement, events: IEvents) В конструктор принимает контейнер и экземпляр класса EventEmitter.
В конструкторе устанавливает слушатели на кнопки выбора способа оплаты.
В методах реализует сеттеры для получения данных из поля ввода, выбранной кнопки, а также сеттер валидности для управления состоянием кнопки подтверждения.

Поля класса:
- _paymentButtons: HTMLButtonElement[] - кнопки выбора способа оплаты


#### Класс Contacts
Предназначен для реализации формы заполнения контактных данных пользователя.\
- constructor(container: HTMLFormElement, events: IEvents) В конструктор принимает контейнер и экземпляр класса EventEmitter.

В методах реализует сеттеры для получения данных из полей ввода, а также сеттер валидности для управления состоянием кнопки подтверждения.


#### Класс Success
Предназначен для реализации модального окна успешного заказа.\
- constructor(container: HTMLFormElement, events: IEvents) В конструктор принимает контейнер и экземпляр класса EventEmitter. В конструкторе устанавливается слушатель на кнопку подтверждения.

Поля класса:
- _close: HTMLButtonElement - Кнопка подтверждения
- _total: HTMLElement - элемент разметки для отображения итоговой стоимости заказа 

Методы:
-set total (total: number) - устанавливает значение итоговой стоимости заказа

#### Класс Page
Отвечает за отображение главной страницы сайта./
- constructor(container: HTMLFormElement, events: IEvents) В конструктор принимает контейнер и экземпляр класса EventEmitter. В конструкторе устанавливается слушатель на кнопку корзины. 


Поля класса:
- _counter: HTMLElement - элемент счетчика корзины
- _cartButton: HTMLButtonElement - кнопка корзины
- _catalog: HTMLElement - контейнер для вывода каталога товаров
- _pageWrapper: HTMLElement - обертка страницы

Методы:
- set counter(value: number) - устанавливает значение счетчика товаров в корзине
- set catalog(items: HTMLElement[]) - заполняет каталог товаров
- set locked(value: boolean) - юлокирует прокрутку страницы


### Слой коммуникации

#### Класс AppApi
Расширяет родительский класс BaseApi и содержит в себе методы для работы с бэкендом./
- constructor(cdn: string, baseUrl: string, options?: RequestInit) В конструктор передается cdn для загрузки изображений, базовый адрес сервера и опциональный объект с заголовками запросов.
Методы: 
- getProduct(id: string): Promise<IProduct> - метод для получения и обработки данных одного товара
- getProducts(): Promise<IProduct[]> - метод для получения и обработки всего массива товаров
- placeOrder(data: IOrder): Promise<OrderResponse> - принимает объект с данными, и вызывает post метод родителя


## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.


Список событий:
События изменения данных (генерируются классами моделями данных):
- `products:set` - запись массива товаров
- `cart:changed` - изменение массива товаров в корзине
- `product:selected` - изменение товара для показа в модальном окне
- `orderForm:change` - изменение данных в форме данных заказа
- `contactsForm:change` - изменение данных в форме контактов

События, возникающие при взаимодействии пользователя с интерфейсом:
- `product:select` - выбор товара для открытия в модальном окне
- `cart:open` - открытие модального окна корзины
- `product:buy` - выбор товара для покупки (нажатие на кнопку "купить")
- `productInCart:delete` - удаление товара из корзины
- `order:open` - продолжение оформления заказа (нажатие на кнопку "оформить" в корзине)
- `order:submit` - подтверждение отправки данных в форме данных заказа
- `contacts:submit` - подтверждение отправки данных в форме данных покупателя и отправка всего заказа на сервер
- `sucsess:submit` - подтверждение в форме успешного заказа
- `modal:open` - модальное окно открыто
- `modal:close` - модальное окно закрыто